# スマートポインタ

- ポインタ = `&` = borrowするだけ
- スマートポインタ = `String`、`Box`、`Vec<T>`のようにデータを所有する
    - 基本的には構造体で実装する
    - `Deref`トレイトを実装する
         - dereferenceのこと = つまり `*` のこと<-> `&`に対応する

## 例

- ヒープに値を確保する `Box<T>`
- 複数の所有権を確保する参照カウント型の`Rc<T>`
- `RefCell<T>` - `Ref<T>`と`RefMut<T>`

## `Box<T>`

`Box<T>`はスタックではなくヒープにデータを格納する

- コンパイル時にサイズがわからないとき
- 所有権をmoveしたいけど、コピーされないことを確認したいとき
- 特定のトレイトを実装する型であることを確認するとき
- `Deref`トレイトを実装しているのでスマートポインタと呼ばれる

## 再帰的な型

- コンパイル時にサイズがわからない型の1つとして再帰的な型がある
    - 型の一部として同じ型の値を持つ型
    - 木構造とか


## [Derefトレイトにより、参照を通してデータにアクセスできる - The Rust Programming Language](https://doc.rust-jp.rs/book/second-edition/ch15-02-deref.html)

- Box強制的な参照外し Unboxがおきる
    - Derefの実装に対して `&`や`*`がなくても動くようにする仕組みが入ってる
    - これによってBoxを関数に渡すとかができるように

## `Drop`トレイト

- スマートポインタの一種
- 値がスコープを抜けたときのRIAAを行う